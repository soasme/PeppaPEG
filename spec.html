<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Low Level APIs" href="lowlevel.html" /><link rel="prev" title="Concepts" href="concepts.html" />

    <meta name="generator" content="sphinx-4.3.2, furo 2022.01.02"/>
        <title>Peppa PEG Specification - Peppa PEG 1.16.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=df49af52631e7917044a9c21a57f7b83170a6dd0" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=fade93df149f7c5fedb3ff897f799dc7d283b420" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Peppa PEG 1.16.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">Peppa PEG 1.16.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutcalc.html">Tutorial: Calculator</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutjson.html">Tutorial: JSON</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="howto.html">How-To Guides</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Peppa PEG Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="lowlevel.html">Low Level APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">All APIs &amp; References</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">Change Log</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="peppa-peg-specification">
<span id="spec"></span><h1>Peppa PEG Specification<a class="headerlink" href="#peppa-peg-specification" title="Permalink to this headline">¶</a></h1>
<section id="objectives">
<h2>Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">¶</a></h2>
<p>Peppa PEG aims to be an opinionated PEG that is easy for parsing the source code into an AST.</p>
<p>Peppa PEG is designed to describe a formal language by extending the original PEG formalism with some user-friendly symbols and notations, such as repetition and back reference in regular expression, cut in Python PEG Grammar , left recursion in EBNF, modifiers in Pest, etc.</p>
</section>
<section id="id1">
<h2>Spec<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Peppa PEG is case-sensitive.</p></li>
<li><p>A Peppa PEG grammar must be a valid UTF-8 encoded Unicode document.</p></li>
</ul>
</section>
<section id="comment">
<h2>Comment<a class="headerlink" href="#comment" title="Permalink to this headline">¶</a></h2>
<p>A hash symbol following by any characters til end of line marks a comment.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>comment = "#" (!"\n" .)* "\n"?;
</pre></div>
</div>
<p>Comments are ignored and can be marked between rules.
This is a simple way of including additional information in parallel with the specifications.</p>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is a full-line comment.</span>

<span class="n">rule</span> <span class="o">=</span> <span class="s2">"# This is not a comment."</span><span class="p">;</span> <span class="c1"># This is a comment at the end of a line.</span>
</pre></div>
</div>
</section>
<section id="rule-naming">
<h2>Rule Naming<a class="headerlink" href="#rule-naming" title="Permalink to this headline">¶</a></h2>
<p>The name of a rule is a sequence of characters, beginning with an alphabet or underscore, and followed by a combination of alphabets, digits, or underscores (_).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="p">([</span><span class="n">a</span><span class="o">-</span><span class="n">z</span><span class="p">]</span><span class="o">/</span><span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Z</span><span class="p">]</span><span class="o">/</span><span class="s2">"_"</span><span class="p">)</span> <span class="p">([</span><span class="n">a</span><span class="o">-</span><span class="n">z</span><span class="p">]</span><span class="o">/</span><span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Z</span><span class="p">]</span><span class="o">/</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">/</span><span class="s2">"_"</span><span class="p">)</span><span class="o">*</span><span class="p">;</span>
</pre></div>
</div>
<p>Rule names are case sensitive.</p>
<p>For example, the rule names listed below are valid:</p>
<ul class="simple">
<li><p><cite>rule</cite></p></li>
<li><p><cite>DIGITS</cite></p></li>
<li><p><cite>oct_int</cite></p></li>
</ul>
<p>while these are invalid:</p>
<ul class="simple">
<li><p><cite>0to9</cite></p></li>
<li><p><cite>ml-string</cite></p></li>
</ul>
</section>
<section id="rule-form">
<h2>Rule Form<a class="headerlink" href="#rule-form" title="Permalink to this headline">¶</a></h2>
<p>The primary building block of a Peppa PEG document is the rule.</p>
<p>A rule is defined by the following sequence:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="o">=</span> <span class="n">decorator</span><span class="o">*</span> <span class="n">name</span> <span class="s2">"="</span> <span class="n">expression</span> <span class="s2">";"</span>
</pre></div>
</div>
<p>where one or more rule decorators may be prefixed before rule names, rule names are on the left-hand side of the equals sign and expressions are one the right-hand side. Rules always ends up with a semicolon (;). The key, equal sign, expressions, and semicolon can be broken over multiple lines. Whitespace is ignored around rule names and between expressions.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="o">=</span> <span class="n">rule2</span> <span class="o">/</span> <span class="s2">"expr4"</span> <span class="o">/</span> <span class="s2">"expr5"</span> <span class="o">/</span> <span class="s2">"expr6"</span><span class="p">;</span>

<span class="nd">@lifted</span>
<span class="n">rule2</span> <span class="o">=</span> <span class="s2">"expr1"</span>
      <span class="o">/</span> <span class="s2">"expr2"</span>
      <span class="o">/</span> <span class="s2">"expr3"</span>
      <span class="p">;</span>
</pre></div>
</div>
<p>Unspecified expressions are invalid.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="o">=</span> <span class="p">;</span> <span class="c1"># INVALID!</span>
</pre></div>
</div>
</section>
<section id="rule-expressions">
<h2>Rule Expressions<a class="headerlink" href="#rule-expressions" title="Permalink to this headline">¶</a></h2>
<p>Rule expressions have the following precedence from highest to lowest:</p>
<ul class="simple">
<li><p>Primary</p></li>
<li><p>Repeat</p></li>
<li><p>Sequence</p></li>
<li><p>Choice</p></li>
<li><p>Left Recursion</p></li>
</ul>
<p>Since left recursion has the lowest precedence, a rule expression always starts interpreting as a left recursion.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expression</span> <span class="o">=</span> <span class="n">left_recursion</span><span class="p">;</span>
</pre></div>
</div>
<p>Primary rule expressions must have one of the following types.</p>
<ul class="simple">
<li><p>Literal</p></li>
<li><p>Insensitive</p></li>
<li><p>Range</p></li>
<li><p>Reference</p></li>
<li><p>Back Reference</p></li>
<li><p>Positive</p></li>
<li><p>Negative</p></li>
<li><p>Dot</p></li>
<li><p>Cut</p></li>
<li><p>Grouping</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>primary = literal
        / insensitive
        / range
        / (reference !"=")
        / back_reference
        / positive
        / negative
        / dot
        / cut
        / "(" choice ")"
        ;
</pre></div>
</div>
<p>Grouping notion () is strongly advised which will avoid misinterpretation by casual readers. For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">foobar</span> <span class="o">=</span> <span class="p">(</span><span class="n">foo</span>  <span class="o">/</span> <span class="n">bar</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">goo</span> <span class="o">/</span> <span class="n">par</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="dot">
<h2>Dot<a class="headerlink" href="#dot" title="Permalink to this headline">¶</a></h2>
<p>Single dot <cite>.</cite> can match any Unicode character. It’s a syntax sugar for [\u0001-\U0010ffff].</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">any</span> <span class="o">=</span> <span class="o">.</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="literal">
<h2>Literal<a class="headerlink" href="#literal" title="Permalink to this headline">¶</a></h2>
<p>The literal matches an exact same string surrounded by double quotes.</p>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="s2">"hello world"</span><span class="p">;</span>
</pre></div>
</div>
<p>Unicode is supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="s2">"你好，世界"</span><span class="p">;</span>
</pre></div>
</div>
<p>Emoji can be encoded via Unicode so it is supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="s2">"Peppa 🐷"</span><span class="p">;</span>
</pre></div>
</div>
<p>You can encode ASCII characters via \x followed by 2 hex digits.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x48\x65\x6c\x6c\x6f</span><span class="s2">, world"</span><span class="p">;</span>
</pre></div>
</div>
<p>You can encode Unicode characters via \u followed by 4 hex digits or \U followed by 8 hex digits.
The escape codes must be valid Unicode <a class="reference external" href="https://unicode.org/glossary/#unicode_scalar_value">scalar values</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\u4f60\u597D</span><span class="s2">, world</span><span class="se">\U0000000c</span><span class="s2">"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="range">
<h2>Range<a class="headerlink" href="#range" title="Permalink to this headline">¶</a></h2>
<p>Range <strong>matches a single character in range</strong>. Ranges are enclosed by [ and ]. The full form is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>range = "[" (
    (char "-" char (".." number)?)
    / ("\p{" range_category "}")
) "]";
</pre></div>
</div>
<p>In the following example, any character between <cite>‘0’</cite> to <cite>‘9’</cite> can match.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">digits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">];</span>
</pre></div>
</div>
<p>The lower and upper character of the range can be not only ASCII characters but also UTF-8 code points.
The syntax can be \xXX, \uXXXX or \uXXXXXXXX.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">digits</span> <span class="o">=</span> <span class="p">[</span>\<span class="n">u4e00</span><span class="o">-</span>\<span class="n">u9fff</span><span class="p">];</span>
</pre></div>
</div>
<p>The value of lower must be less or equal than the upper.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">any</span> <span class="o">=</span> <span class="p">[</span>\<span class="n">U0010ffff</span><span class="o">-</span>\<span class="n">u0001</span><span class="p">];</span> <span class="c1"># INVALID!!!</span>
</pre></div>
</div>
<p>Range supports an optional <cite>stride</cite> to skip certain amount of characters in the range.
In this example, only odd number between <cite>‘0’</cite> to <cite>‘9’</cite> can match.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">digits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mf">9..2</span><span class="p">];</span>
</pre></div>
</div>
<p>Range can support Unicode general categories and properties by wrapping filters with \p{}, such as <cite>C</cite>, <cite>Cc</cite>, <cite>Cf</cite>, <cite>Co</cite>, <cite>Cs</cite>, <cite>Ll</cite>, <cite>Lm</cite>, <cite>Lo</cite>, <cite>Lt</cite>, <cite>Lu</cite>, <cite>L</cite>, <cite>Nd</cite>, <cite>Nl</cite>, <cite>No</cite>, <cite>N</cite>, <cite>Id_Start</cite>, <cite>Id_Continue</cite>, <cite>Other_Id_Start</cite>, <cite>Other_Id_Continue</cite>, <cite>White space</cite>, etc.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">range_category</span> <span class="o">=</span> <span class="p">([</span><span class="n">a</span><span class="o">-</span><span class="n">z</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Z</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="o">/</span> <span class="s2">"_"</span> <span class="o">/</span> <span class="s2">" "</span><span class="p">)</span><span class="o">+</span><span class="p">;</span>
</pre></div>
</div>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unicode_letter</span> <span class="o">=</span> <span class="p">[</span>\<span class="n">p</span><span class="p">{</span><span class="n">L</span><span class="p">}];</span>  <span class="c1"># Any Unicode Letter (Ll, Lm, Lo, Lt, Lu).</span>
<span class="n">unicode_digit</span>  <span class="o">=</span> <span class="p">[</span>\<span class="n">p</span><span class="p">{</span><span class="n">Nd</span><span class="p">}];</span> <span class="c1"># Any Number, decimal digit (Nd).</span>
</pre></div>
</div>
<p>Whether range category is supported depends on the implementations.</p>
</section>
<section id="sequence">
<h2>Sequence<a class="headerlink" href="#sequence" title="Permalink to this headline">¶</a></h2>
<p>Sequence <strong>matches a sequence of rules in order</strong>, e.g. a concatenation of contiguous characters.</p>
<p>The full form is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sequence</span> <span class="o">=</span> <span class="n">repeat</span><span class="o">+</span><span class="p">;</span>
</pre></div>
</div>
<p>The first sequence element is attempted. If succeeds, the second is attempted, so on and on.
If any one of the attempts fails, the match fails.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeter</span> <span class="o">=</span> <span class="s2">"Hello"</span> <span class="s2">" "</span> <span class="s2">"world"</span><span class="p">;</span>
</pre></div>
</div>
<p>Elements enclosed in parentheses are considered as a single element. Thus,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="o">=</span> <span class="n">prefix</span> <span class="p">(</span><span class="n">foo</span> <span class="o">/</span> <span class="n">bar</span><span class="p">)</span> <span class="n">postfix</span><span class="p">;</span>
</pre></div>
</div>
<p>matches either (prefix foo postfix) or (prefix bar postfix), and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="o">=</span> <span class="n">prefix</span> <span class="n">foo</span> <span class="o">/</span> <span class="n">bar</span> <span class="n">postfix</span><span class="p">;</span>
</pre></div>
</div>
<p>matches either (prefix foo) or (bar postfix).</p>
</section>
<section id="choice">
<h2>Choice<a class="headerlink" href="#choice" title="Permalink to this headline">¶</a></h2>
<p>Choice <strong>matches one of the alternatives</strong>.</p>
<p>Elements in the choice separated by a forward slash (/) are alternatives. The full form of choice is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">choice</span> <span class="o">=</span> <span class="n">sequence</span> <span class="p">(</span><span class="s2">"/"</span> <span class="n">sequence</span><span class="p">)</span><span class="o">*</span><span class="p">;</span>
</pre></div>
</div>
<p>The first alternative is attempted. If fails, the second is attempted, so on and on.
If any one of the attempts succeeds, the match succeeds. If all attempts fail, the match fails.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeter</span> <span class="o">=</span> <span class="s2">"Hello World"</span> <span class="o">/</span> <span class="s2">"你好，世界"</span> <span class="o">/</span> <span class="s2">"Kia Ora"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="left-recursion">
<h2>Left Recursion<a class="headerlink" href="#left-recursion" title="Permalink to this headline">¶</a></h2>
<p>A left recursion starts with a lhs expression, followed by a | symbol, the same reference to the rule name, and a rhs expression. The full form of left recursion is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>left_recursion = lhs ("|" reference rhs)?;
lhs = choice;
rhs = choice;
</pre></div>
</div>
<p>Left recursion expression <strong>matches left-hand side sub-expression first, then matches right-hand side sub-expression repeatly</strong>. Whenever a right-hand side expression is matched, together with what has matched by the left-hand side expression, a new node is left recursively added to the tree.</p>
<p>For example, consider the following minimal arithmetic grammar rule,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="o">=</span> <span class="n">E</span> <span class="o">|</span> <span class="n">S</span> <span class="n">add_op</span> <span class="n">E</span><span class="p">;</span>
<span class="n">add_op</span> <span class="o">=</span> <span class="s2">"+"</span><span class="p">;</span>
<span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">];</span>
</pre></div>
</div>
<p>Rule S is similar to <cite>@nonterminal S = F (add_op F)*;</cite>. Unlike the repetition form generating flat hierarchy, given input 1+2+3, it produces such a tree:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">"slice"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"S"</span><span class="p">,</span>
    <span class="s2">"children"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"slice"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"S"</span><span class="p">,</span>
            <span class="s2">"children"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">"slice"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"E"</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"slice"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"op"</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"slice"</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"E"</span><span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span><span class="s2">"slice"</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"op"</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">"slice"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"E"</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Peppa PEG supports a limited form of left recursion in the sense that,</p>
<ol class="arabic simple">
<li><p>Neither lhs nor rhs expression can have left recursion. Otherwise, the implementation may run out of stack space, resulting in stack overflow.</p></li>
<li><p>Indirect left recursion is not allowed, e.g, the reference followed by symbol | must be identical to the rule name.</p></li>
<li><p>Left recursion rule cannot be wrapped into a group by using parentheses.</p></li>
</ol>
<p>Full adoption of left recursion may bring ambiguity into the result parsing tree, which violates one of the PEG’s fundamental characteristics.
Nonetheless, left recursion is widely used and encouraged form in some CFG parsers, such as EBNF.
By making this practical decision, users can use PEG with left recursion for a certain of use cases.</p>
</section>
<section id="right-recursion">
<h2>Right Recursion<a class="headerlink" href="#right-recursion" title="Permalink to this headline">¶</a></h2>
<p>PEG supports right recursion in nature by using sequence, choice and reference to the rule itself.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">pow</span> <span class="o">=</span> <span class="n">num</span> <span class="s2">"^"</span> <span class="nb">pow</span> <span class="o">/</span> <span class="n">num</span><span class="p">;</span>
<span class="n">num</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">];</span>
</pre></div>
</div>
<p>given input 1^2^3, the parser should generate such a tree:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">"slice"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"pow"</span><span class="p">,</span>
    <span class="s2">"children"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">"slice"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"num"</span><span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"slice"</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"pow"</span><span class="p">,</span>
            <span class="s2">"children"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">"slice"</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"num"</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">"slice"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"num"</span><span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>e.g. (1^(2^3)).</p>
</section>
<section id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<p>Reference <strong>matches a string based on the referenced grammar rule</strong>. A reference has the same specification of rule name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="p">([</span><span class="n">a</span><span class="o">-</span><span class="n">z</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Z</span><span class="p">]</span> <span class="o">/</span> <span class="s2">"_"</span><span class="p">)</span> <span class="p">([</span><span class="n">a</span><span class="o">-</span><span class="n">z</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Z</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="o">/</span> <span class="s2">"_"</span><span class="p">)</span><span class="o">*</span><span class="p">;</span>
</pre></div>
</div>
<p>For example, <cite>greeter</cite> is just a reference rule in <cite>greeting</cite>. When matching <cite>greeting</cite>, it will use the referenced grammar rule <cite>greeter</cite> first, e.g. <cite>“Hello” / “你好”</cite>, then match ” world”.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="n">greeter</span> <span class="s2">" world"</span><span class="p">;</span>
<span class="n">greeter</span>  <span class="o">=</span> <span class="s2">"Hello"</span> <span class="o">/</span> <span class="s2">"你好"</span><span class="p">;</span>
</pre></div>
</div>
<p>The order of defining a rule does not matter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeter</span>  <span class="o">=</span> <span class="s2">"Hello"</span> <span class="o">/</span> <span class="s2">"你好"</span><span class="p">;</span>
<span class="n">greeting</span> <span class="o">=</span> <span class="n">greeter</span> <span class="s2">" world"</span><span class="p">;</span>
</pre></div>
</div>
<p>One should ensure all references must have corresponding rule defined, otherwise, the parse fails due to an undefined rule.</p>
</section>
<section id="back-reference">
<h2>Back Reference<a class="headerlink" href="#back-reference" title="Permalink to this headline">¶</a></h2>
<p>Back reference <strong>matches an exact same string as previously matched in the sequence</strong>.</p>
<p>Back reference starts with a back slash, followed by a number. The number is zero-based and cannot be a number greater than or equal to the index of itself. The number indicates which previous member in the sequence should be back referenced. The full form is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">back_reference</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\"</span><span class="s2"> number;</span>
</pre></div>
</div>
<p>In the following example, \0 matches whatever <cite>quote</cite> has matched, thus <cite>“a”</cite> or <cite>‘a’</cite> are valid. But <cite>“a’</cite> or <cite>‘a”</cite> are invalid.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">str</span> <span class="o">=</span> <span class="n">quote</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">z</span><span class="p">]</span> \<span class="mi">0</span><span class="p">;</span>
<span class="n">quote</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span> <span class="o">/</span> <span class="s2">"'"</span><span class="p">;</span>
</pre></div>
</div>
<p>Back reference is applicable only to the named rule. Thus, the following rule can match “abaa” but not “abba”.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="o">=</span> <span class="s2">"a"</span> <span class="p">(</span><span class="s2">"b"</span> \<span class="mi">0</span><span class="p">)</span> \<span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="insensitive">
<h2>Insensitive<a class="headerlink" href="#insensitive" title="Permalink to this headline">¶</a></h2>
<p>Insensitive operator starts with “i” and followed by a literal or back reference.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">insensitive</span> <span class="o">=</span> <span class="s2">"i"</span> <span class="p">(</span><span class="n">literal</span> <span class="o">/</span> <span class="n">back_reference</span><span class="p">);</span>
</pre></div>
</div>
<p>For example,</p>
<p>Given the following rule, back reference \0 is case-insensitive. Hence, both <cite>a=A</cite> and <cite>a=a</cite> are valid.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">z</span><span class="p">]</span> <span class="s2">"="</span> <span class="n">i</span>\<span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>Given the following rule, literal “hello world” is case-insensitive. Hence, both <cite>ì</cite> and <cite>Ì</cite> are valid.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="o">=</span> <span class="n">i</span><span class="s2">"ì"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="positive">
<h2>Positive<a class="headerlink" href="#positive" title="Permalink to this headline">¶</a></h2>
<p>Positive <strong>tests if a primary expression can match</strong>. Positive starts with &amp; and followed by a primary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">positive</span> <span class="o">=</span> <span class="s2">"&amp;"</span> <span class="n">primary</span><span class="p">;</span>
</pre></div>
</div>
<p>Positive attempts to match the primary expression. If succeeds, the test passes. Positive does not “consume” any text.</p>
<p>Positive can be useful in limiting the possibilities of the latter member in a Sequence. In this example, the Sequence expression must start with “Hello”. Given “Hello World”, “Hello WORLD”, “Hello world” it will match. Given “HELLO WORLD” it will not match.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="o">&amp;</span><span class="s2">"Hello"</span> <span class="n">i</span><span class="s2">"hello world"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="negative">
<h2>Negative<a class="headerlink" href="#negative" title="Permalink to this headline">¶</a></h2>
<p>Negative <strong>tests if a primary expression failed to match</strong>. Negative starts with ! and followed by a primary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">negative</span> <span class="o">=</span> <span class="s2">"!"</span> <span class="n">primary</span><span class="p">;</span>
</pre></div>
</div>
<p>Negative expects the primary expression doesn’t match. If fails, the test passes. Negative does not “consume” any text.</p>
<p>In this example, the <cite>greeting</cite> rule must not start with “Hello”. Given “HELLO World”, “hello WORLD”, “hello world”, it will match. Given “Hello World”, it will not match.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>greeting = !"Hello" i"hello world";
</pre></div>
</div>
</section>
<section id="repetition">
<h2>Repetition<a class="headerlink" href="#repetition" title="Permalink to this headline">¶</a></h2>
<p>Operators <cite>+</cite>, <cite>*</cite>, <cite>?</cite> and <cite>{}</cite> followed by an expression indicates repetition.</p>
<p>The full form of repetition is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>repeat = primary (onceormore / zeroormore / zerooronce / repeatexact / repeatminmax / repeatmin / repeatmax)?;
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Plus (<cite>+</cite>) matches string one or more times.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onceormore</span> <span class="o">=</span> <span class="s2">"+"</span><span class="p">;</span>
</pre></div>
</div>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">number</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Asterisk (<cite>*</cite>) matches string zero or more times.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zeroormore</span> <span class="o">=</span> <span class="s2">"*"</span><span class="p">;</span>
</pre></div>
</div>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">number</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Question (<cite>?</cite>) matches string one or more times.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zerooronce</span> <span class="o">=</span> <span class="s2">"?"</span><span class="p">;</span>
</pre></div>
</div>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>number = [0-9] "."?;
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p><cite>{cnt}</cite> matches exactly <cite>cnt</cite> occurrences of an expression, where cnt is a decimal value.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">repeatexact</span> <span class="o">=</span> <span class="s2">"{"</span> <span class="n">number</span> <span class="s2">"}"</span><span class="p">;</span>
</pre></div>
</div>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unicode</span> <span class="o">=</span> <span class="s2">"\U"</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">f</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">F</span><span class="p">]){</span><span class="mi">8</span><span class="p">};</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p><cite>{min,max}</cite> matches an expression of at least <cite>min</cite> occurrences and at most <cite>max</cite> occurrences, where min and max are decimal values.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">repeatminmax</span> <span class="o">=</span> <span class="s2">"{"</span> <span class="n">number</span> <span class="s2">","</span> <span class="n">number</span> <span class="s2">"}"</span><span class="p">;</span>
</pre></div>
</div>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">hex</span> <span class="o">=</span> <span class="s2">"\u{"</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">f</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">F</span><span class="p">]){</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">}</span> <span class="s2">"}"</span><span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p><cite>{min,}</cite> matches an expression of at least <cite>min</cite> occurrences, where min is a decimal value.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">repeatmin</span> <span class="o">=</span> <span class="s2">"{"</span> <span class="n">number</span> <span class="s2">","</span> <span class="s2">"}"</span><span class="p">;</span>
</pre></div>
</div>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">above_hundred</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">2</span><span class="p">,};</span>
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p><cite>{,max}</cite> matches an expression of at most <cite>max</cite> occurrences, where max is a decimal value.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">repeatmax</span> <span class="o">=</span> <span class="s2">"{"</span> <span class="s2">","</span> <span class="n">number</span> <span class="s2">"}"</span><span class="p">;</span>
</pre></div>
</div>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">below_thousand</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{,</span><span class="mi">3</span><span class="p">};</span>
</pre></div>
</div>
</section>
<section id="cut">
<h2>Cut<a class="headerlink" href="#cut" title="Permalink to this headline">¶</a></h2>
<p>Cut is a decorator written as “~”. It always succeeds, but cannot be backtracked.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cut</span> <span class="o">=</span> <span class="s2">"~"</span><span class="p">;</span>
</pre></div>
</div>
<p>It’s used to prevent unwanted backtracking, e.g. to prevent excessive choice options.</p>
<p>Backtracking means if e1 in <cite>rule = e1 / e2;</cite> fails, the parser returns the last position where e1 started, and tries e2.
If there is a <cite>~</cite> in e1, any failure after the cutting point will cause rule failed immediately.
Cut ensures the parse sticks to the current rule, even if it fails to parse.
See ideas <a class="reference external" href="http://ceur-ws.org/Vol-1269/paper232.pdf">1</a>, <a class="reference external" href="https://news.ycombinator.com/item?id=20503245">2</a>.</p>
<p>For example, let’s first consider the following grammar,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">array</span> <span class="o">/</span> <span class="n">null</span><span class="p">;</span>
<span class="n">array</span> <span class="o">=</span> <span class="s2">"["</span> <span class="s2">"]"</span><span class="p">;</span>
<span class="n">null</span>  <span class="o">=</span> <span class="s2">"null"</span><span class="p">;</span>
</pre></div>
</div>
<p>Given input “[”, it attempts matching array first. After failed, it will try null next. At last, value match is failed.</p>
<p>Let’s add a cut operator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">array</span> <span class="o">/</span> <span class="n">null</span><span class="p">;</span>
<span class="n">array</span> <span class="o">=</span> <span class="s2">"["</span> <span class="o">~</span> <span class="s2">"]"</span><span class="p">;</span>
<span class="n">null</span>  <span class="o">=</span> <span class="s2">"null"</span><span class="p">;</span>
</pre></div>
</div>
<p>Given input “[”, it attempts matching array first. After failed, value match is failed immediately.</p>
<p>Given input “null”, it attempts matching array first. It fails before ~ and then failed matching array. Parser then match “null” successfully.</p>
</section>
<section id="decorators">
<h2>Decorators<a class="headerlink" href="#decorators" title="Permalink to this headline">¶</a></h2>
<p>Decorators are characters @ followed by some selected keywords.
Valid decorators include: <cite>@spaced</cite>, <cite>@squashed</cite>, <cite>@scoped</cite>, <cite>@tight</cite>, <cite>@lifted</cite> and <cite>@nonterminal</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">decorator</span> <span class="o">=</span> <span class="s2">"@"</span> <span class="p">(</span><span class="s2">"squashed"</span> <span class="o">/</span> <span class="s2">"scoped"</span> <span class="o">/</span> <span class="s2">"spaced"</span> <span class="o">/</span> <span class="s2">"lifted"</span> <span class="o">/</span> <span class="s2">"nonterminal"</span><span class="p">);</span>
</pre></div>
</div>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@spaced</span> <span class="nd">@lifted</span>
<span class="n">ws</span> <span class="o">=</span> <span class="s2">" "</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="spaced">
<h2>@spaced<a class="headerlink" href="#spaced" title="Permalink to this headline">¶</a></h2>
<p>A <cite>@spaced</cite> rule will be auto-inserted in elements of sequences and repetitions.</p>
<p>For example, my_sequence can match “helloworld”, “hello world”, “hello  t  n world”, etc.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_sequence</span> <span class="o">=</span> <span class="s2">"hello"</span> <span class="s2">"world"</span><span class="p">;</span>

<span class="nd">@spaced</span>
<span class="n">ws</span> <span class="o">=</span> <span class="s2">" "</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
</pre></div>
</div>
<p>Rule my_sequence is in essence equivalent to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_sequence</span> <span class="o">=</span> <span class="s2">"hello"</span> <span class="p">(</span><span class="s2">" "</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span><span class="o">*</span> <span class="s2">"world"</span><span class="p">;</span>
</pre></div>
</div>
<p>There may be multiple <cite>@spaced</cite> rules in the grammar. Thus,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_sequence2</span> <span class="o">=</span> <span class="s2">"hello"</span> <span class="s2">"world"</span><span class="p">;</span>

<span class="nd">@spaced</span>
<span class="n">ws</span> <span class="o">=</span> <span class="s2">" "</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

<span class="nd">@spaced</span>
<span class="n">dot</span> <span class="o">=</span> <span class="s2">"."</span><span class="p">;</span>
</pre></div>
</div>
<p>Rule my_sequence is equivalent to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_sequence2</span> <span class="o">=</span> <span class="s2">"hello"</span> <span class="p">((</span><span class="s2">" "</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span> <span class="o">/</span> <span class="s2">"."</span><span class="p">)</span><span class="o">*</span> <span class="s2">"world"</span><span class="p">;</span>
</pre></div>
</div>
<p>The <cite>@spaced</cite> rules only take effects for rules having no <cite>@tight</cite> decorators.</p>
</section>
<section id="tight">
<h2>@tight<a class="headerlink" href="#tight" title="Permalink to this headline">¶</a></h2>
<p>A <cite>@tight</cite> rule deters any <cite>@spaced</cite> rule from auto-inserted.</p>
<p>For example, my_sequence can only match “helloworld”.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@tight</span>
<span class="n">my_sequence</span> <span class="o">=</span> <span class="s2">"hello"</span> <span class="s2">"world"</span><span class="p">;</span>

<span class="nd">@spaced</span>
<span class="n">ws</span> <span class="o">=</span> <span class="s2">" "</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="lifted">
<h2>@lifted<a class="headerlink" href="#lifted" title="Permalink to this headline">¶</a></h2>
<p>A <cite>@lifted</cite> rule replaces the node with its children in the parse tree, if exists any children.</p>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span> <span class="o">=</span> <span class="n">lit</span><span class="p">;</span>

<span class="nd">@lifted</span>
<span class="n">lit</span> <span class="o">=</span> <span class="n">digit</span> <span class="o">/</span> <span class="n">char</span><span class="p">;</span>

<span class="n">number</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="p">;</span>
<span class="n">char</span>   <span class="o">=</span> <span class="p">([</span><span class="n">a</span><span class="o">-</span><span class="n">z</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Z</span><span class="p">])</span><span class="o">+</span><span class="p">;</span>
</pre></div>
</div>
<p>given input “42”, the parsed tree looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"rule"</span><span class="p">,</span>
    <span class="s2">"children"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"number"</span><span class="p">,</span> <span class="s2">"text"</span><span class="p">:</span> <span class="s2">"4"</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"number"</span><span class="p">,</span> <span class="s2">"text"</span><span class="p">:</span> <span class="s2">"2"</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This decorator is useful for trimming some unnecessary nodes in the parse tree.</p>
</section>
<section id="nonterminal">
<h2>@nonterminal<a class="headerlink" href="#nonterminal" title="Permalink to this headline">¶</a></h2>
<p>A <cite>@nonterminal</cite> rule replaces the node with its children in the parse tree, if exists one child.
If the rule produces multiple children, this decorator has no effect.</p>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@nonterminal
add = number ("+" number)?;

number = [0-9];
</pre></div>
</div>
<p>given input “1”, the tree is like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"add"</span><span class="p">,</span> <span class="s2">"text"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">}</span>
</pre></div>
</div>
<p>given input “1+2”, the tree is like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"add"</span><span class="p">,</span>
    <span class="s2">"children"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"number"</span><span class="p">,</span> <span class="s2">"text"</span><span class="p">:</span> <span class="s2">"1"</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"number"</span><span class="p">,</span> <span class="s2">"text"</span><span class="p">:</span> <span class="s2">"2"</span><span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="squashed">
<h2>@squashed<a class="headerlink" href="#squashed" title="Permalink to this headline">¶</a></h2>
<p>A <cite>@squashed</cite> rule drops all node children in the parse tree.</p>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@squashed
float = number ("." number)?;

number = [0-9];
</pre></div>
</div>
<p>given input “1.0”, rule <cite>float</cite> drops all <cite>number</cite> nodes, leaving only one single node in the ast:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"float"</span><span class="p">,</span> <span class="s2">"text"</span><span class="p">:</span> <span class="s2">"1.0"</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="scoped">
<h2>@scoped<a class="headerlink" href="#scoped" title="Permalink to this headline">¶</a></h2>
<p>A <cite>@scoped</cite> rule reset all decorators that inherit from upstream rules.</p>
<p>For example, despite <cite>greeting2</cite> set to not using spaced rule <cite>ws</cite>, <cite>greeting</cite> can still apply to <cite>ws</cite> since it’s under its own scope.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@tight</span>
<span class="n">greeting2</span> <span class="o">=</span> <span class="n">greeting</span> <span class="n">greeting</span><span class="p">;</span>

<span class="nd">@scoped</span>
<span class="n">greeting</span> <span class="o">=</span> <span class="s2">"hello"</span> <span class="s2">"world"</span><span class="p">;</span>

<span class="nd">@spaced</span>
<span class="n">ws</span> <span class="o">=</span> <span class="s2">" "</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="cheatsheet">
<h2>Cheatsheet<a class="headerlink" href="#cheatsheet" title="Permalink to this headline">¶</a></h2>
<div class="table-wrapper"><table class="docutils align-default" id="id4">
<caption><span class="caption-text">Cheatsheet</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%"/>
<col style="width: 50%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Syntax</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>foo = …;</cite></p></td>
<td><p>grammar rule</p></td>
</tr>
<tr class="row-odd"><td><p><cite>@lifted foo = …;</cite></p></td>
<td><p>drop node</p></td>
</tr>
<tr class="row-even"><td><p><cite>@spaced foo = …;</cite></p></td>
<td><p>mark as space</p></td>
</tr>
<tr class="row-odd"><td><p><cite>@squashed foo = …;</cite></p></td>
<td><p>ignore children</p></td>
</tr>
<tr class="row-even"><td><p><cite>@tight foo = …;</cite></p></td>
<td><p>ignore spaced rules</p></td>
</tr>
<tr class="row-odd"><td><p><cite>@non_terminal foo = …;</cite></p></td>
<td><p>ignore single child node</p></td>
</tr>
<tr class="row-even"><td><p><cite>@scoped foo = …;</cite></p></td>
<td><p>cancle effects</p></td>
</tr>
<tr class="row-odd"><td><p><cite>“literal”</cite></p></td>
<td><p>exact match</p></td>
</tr>
<tr class="row-even"><td><p><cite>“x0dx0a”</cite></p></td>
<td><p>exact match by using ascii digits</p></td>
</tr>
<tr class="row-odd"><td><p><cite>“u4f60u597D”</cite></p></td>
<td><p>exact match utf-8 characters</p></td>
</tr>
<tr class="row-even"><td><p><cite>i”literal”</cite></p></td>
<td><p>case-insensitive match</p></td>
</tr>
<tr class="row-odd"><td><p><cite>[a-z]</cite></p></td>
<td><p>range</p></td>
</tr>
<tr class="row-even"><td><p><cite>[0-9..2]</cite></p></td>
<td><p>range with stride</p></td>
</tr>
<tr class="row-odd"><td><p><cite>[\u0001-\U0010ffff]</cite></p></td>
<td><p>range using unicode runes</p></td>
</tr>
<tr class="row-even"><td><p><cite>[\p{L}]</cite></p></td>
<td><p>range using unicode categories</p></td>
</tr>
<tr class="row-odd"><td><p><cite>.</cite></p></td>
<td><p>any character</p></td>
</tr>
<tr class="row-even"><td><p><cite>foo bar</cite></p></td>
<td><p>sequence</p></td>
</tr>
<tr class="row-odd"><td><p><cite>foo / bar</cite></p></td>
<td><p>choice</p></td>
</tr>
<tr class="row-even"><td><p>\0</p></td>
<td><p>back reference</p></td>
</tr>
<tr class="row-odd"><td><p><cite>&amp;foo</cite></p></td>
<td><p>positive</p></td>
</tr>
<tr class="row-even"><td><p><cite>!foo</cite></p></td>
<td><p>negative</p></td>
</tr>
<tr class="row-odd"><td><p><cite>~</cite></p></td>
<td><p>prevent unwanted backtracking</p></td>
</tr>
<tr class="row-even"><td><p><cite>foo*</cite></p></td>
<td><p>zero or more</p></td>
</tr>
<tr class="row-odd"><td><p><cite>foo+</cite></p></td>
<td><p>once or more</p></td>
</tr>
<tr class="row-even"><td><p><cite>foo?</cite></p></td>
<td><p>optional</p></td>
</tr>
<tr class="row-odd"><td><p><cite>foo{m,}</cite></p></td>
<td><p>repeat at least m times</p></td>
</tr>
<tr class="row-even"><td><p><cite>foo{,n}</cite></p></td>
<td><p>repeat at most n times</p></td>
</tr>
<tr class="row-odd"><td><p><cite>foo{m,n}</cite></p></td>
<td><p>repeat between m-n times</p></td>
</tr>
<tr class="row-even"><td><p><cite>foo{m}</cite></p></td>
<td><p>repeat exact n times</p></td>
</tr>
<tr class="row-odd"><td><p><cite># IGNORE</cite></p></td>
<td><p>comment</p></td>
</tr>
</tbody>
</table></div>
</section>
<section id="appendix-peppa-peg-of-peppa-peg">
<h2>Appendix. Peppa PEG of Peppa PEG<a class="headerlink" href="#appendix-peppa-peg-of-peppa-peg" title="Permalink to this headline">¶</a></h2>
<p>This appendix includes the full form of Peppa PEG specification.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>grammar = start_of_input rule+ end_of_input;

start_of_input = &amp;.;
end_of_input = !.;

rule = decorators name ~ "=" expression ";";

decorators = decorator*;
decorator = "@" ~ (
    "squashed"
    / "scoped"
    / "spaced"
    / "lifted"
    / "tight"
    / "nonterminal"
);

@squashed
name = reference;

@lifted
expression = left_recursion;

@nonterminal
left_recursion = choice ("|" ~ reference choice)?;

@nonterminal
choice = sequence ("/" sequence)*;

@nonterminal
sequence = repeat+;

@nonterminal
repeat = primary (
    onceormore
    / zeroormore
    / zerooronce
    / repeatexact
    / repeatminmax
    / repeatmin
    / repeatmax
)?;
onceormore = "+";
zeroormore = "*";
zerooronce = "?";
repeatexact = "{" number "}";
repeatminmax = "{" number "," number "}";
repeatmin = "{" number "," "}";
repeatmax = "{" "," number "}";

@lifted
primary = literal
        / insensitive
        / range
        / (reference !"=")
        / back_reference
        / positive
        / negative
        / "(" choice ")"
        / dot
        / cut;

@squashed @tight
literal = "\"" ~ chars "\"";
chars = char*;
@squashed @tight
char = [\x20-\x21] / [\x23-\x5b] / [\x5d-\U0010ffff] / (
    "\\" (
        "\""
        / "/"
        / "\\"
        / "b"
        / "f"
        / "n"
        / "r"
        / "t"
        / ("x" ~ two_hexdigits)
        / ("u" ~ four_hexdigits)
        / ("U" ~ eight_hexdigits)
    )
);

@squashed @tight
range_category = ([a-z] / [A-Z] / [0-9] / "_" / " ")+;

range = "[" (
    (char "-" char (".." number)?)
    / ("\\p{" range_category "}")
) "]";

@tight
insensitive = "i" (literal / back_reference);

@squashed @tight
reference = ([a-z] / [A-Z] / "_") ([a-z] / [A-Z] / [0-9] / "_")*;

@tight
back_reference = "\\" ~ number;

positive = "&amp;" ~ primary;
negative = "!" ~ primary;

dot = ".";
cut = "~";

hexdigit = [0-9] / [a-f] / [A-F];
two_hexdigits = hexdigit{2};
four_hexdigits = hexdigit{4};
eight_hexdigits = hexdigit{8};

@squashed @tight
number = "0" / [1-9] [0-9]*;
@lifted @spaced
comment = "#" (!"\n" .)* "\n"?;

@lifted @spaced
whitespace = " " / "\t" / "\r" / "\n";
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="lowlevel.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Low Level APIs</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="concepts.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Concepts</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Ju |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="_sources/spec.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Peppa PEG Specification</a><ul>
<li><a class="reference internal" href="#objectives">Objectives</a></li>
<li><a class="reference internal" href="#id1">Spec</a></li>
<li><a class="reference internal" href="#comment">Comment</a></li>
<li><a class="reference internal" href="#rule-naming">Rule Naming</a></li>
<li><a class="reference internal" href="#rule-form">Rule Form</a></li>
<li><a class="reference internal" href="#rule-expressions">Rule Expressions</a></li>
<li><a class="reference internal" href="#dot">Dot</a></li>
<li><a class="reference internal" href="#literal">Literal</a></li>
<li><a class="reference internal" href="#range">Range</a></li>
<li><a class="reference internal" href="#sequence">Sequence</a></li>
<li><a class="reference internal" href="#choice">Choice</a></li>
<li><a class="reference internal" href="#left-recursion">Left Recursion</a></li>
<li><a class="reference internal" href="#right-recursion">Right Recursion</a></li>
<li><a class="reference internal" href="#reference">Reference</a></li>
<li><a class="reference internal" href="#back-reference">Back Reference</a></li>
<li><a class="reference internal" href="#insensitive">Insensitive</a></li>
<li><a class="reference internal" href="#positive">Positive</a></li>
<li><a class="reference internal" href="#negative">Negative</a></li>
<li><a class="reference internal" href="#repetition">Repetition</a></li>
<li><a class="reference internal" href="#cut">Cut</a></li>
<li><a class="reference internal" href="#decorators">Decorators</a></li>
<li><a class="reference internal" href="#spaced">&#64;spaced</a></li>
<li><a class="reference internal" href="#tight">&#64;tight</a></li>
<li><a class="reference internal" href="#lifted">&#64;lifted</a></li>
<li><a class="reference internal" href="#nonterminal">&#64;nonterminal</a></li>
<li><a class="reference internal" href="#squashed">&#64;squashed</a></li>
<li><a class="reference internal" href="#scoped">&#64;scoped</a></li>
<li><a class="reference internal" href="#cheatsheet">Cheatsheet</a></li>
<li><a class="reference internal" href="#appendix-peppa-peg-of-peppa-peg">Appendix. Peppa PEG of Peppa PEG</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    </body>
</html>